{% extends "global/Page.html" %}

{% block custom_styles %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap');
  @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css');

  body {
    font-family: 'Montserrat', sans-serif;
  }

  .rating-row {
  display: grid;
  grid-template-columns: 160px 1fr;
  align-items: center;
  gap: 12px;
  margin-bottom: 0.75rem;
}

.rating-slider {
  accent-color: #adb5bd;
}

.rating-slider.touched {
  accent-color: #198754;
}

.rating-slider.touched::-webkit-slider-thumb {
  box-shadow: 0 0 0 4px rgba(25, 135, 84, 0.25);
}

.rating-slider.touched::-moz-range-thumb {
  box-shadow: 0 0 0 4px rgba(25, 135, 84, 0.25);
}

</style>
{% endblock %}

{% block content %}
<div class="d-flex align-items-center mb-4 p-3 rounded bg-light border">
  <i class="fas fa-star me-3 text-primary" style="font-size:1.6rem;"></i>
  <div>
    <div class="text-muted small">Step 4</div>
    <h4 class="mb-0 fw-semibold">Evaluate group members</h4>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <div class="mb-2">
      <strong>Statement:</strong>
    </div>
    <div class="p-2 bg-light rounded">
      {{ statement }}
    </div>

    <div class="mt-3">
      <span class="text-muted ms-2">âˆ’10 (totally disagree) - 10 (totally agree)</span>
    </div>
  </div>
</div>

<p class="mb-4">
  Please evaluate each group member and their motivation based on the following dimensions.
</p>

{% for r in others_rows %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">

      <div class="mb-3 d-block bg-light p-2 rounded">
        <strong>{{ r.who }}</strong>
        <div class="text-muted small mt-1">
          Opinion: <span class="badge bg-secondary">{{ r.opinion }}</span>
        </div>
        <div class="text-muted small mt-1" style="white-space: pre-wrap;">Motivation: {{ r.motivation }}
        </div>
      </div>

      <div class="rating-row">
  <strong>Likability</strong>

  <div class="d-flex align-items-center gap-3">
    <span class="text-danger">
      <i class="fas fa-angry"></i>
    </span>

    <input type="range"
       class="form-range flex-grow-1 rating-slider"
       name="like_{{ r.idx }}" id="id_like_{{ r.idx }}"
       min="{{ min_rating }}" max="{{ max_rating }}" step="1" value="0"
       data-touched="0"
       oninput="document.getElementById('val_like_{{ r.idx }}').textContent=this.value;">


    <span class="badge bg-secondary" id="val_like_{{ r.idx }}">0</span>

    <span class="text-success">
      <i class="fas fa-smile"></i>
    </span>
  </div>
</div>

      <div class="rating-row">
  <strong>Argumentation</strong>

  <div class="d-flex align-items-center gap-3">
    <span class="text-danger">
      <i class="fas fa-angry"></i>
    </span>

   <input type="range"
       class="form-range flex-grow-1 rating-slider"
       name="strength_{{ r.idx }}" id="id_strength_{{ r.idx }}"
       min="{{ min_rating }}" max="{{ max_rating }}" step="1" value="0"
       data-touched="0"
       oninput="document.getElementById('val_strength_{{ r.idx }}').textContent=this.value;"
>

    <span class="badge bg-secondary" id="val_strength_{{ r.idx }}">0</span>

    <span class="text-success">
      <i class="fas fa-smile"></i>
    </span>
  </div>
</div>

      <div class="rating-row">
  <strong>Trustworthiness</strong>

  <div class="d-flex align-items-center gap-3">
    <span class="text-danger">
      <i class="fas fa-angry"></i>
    </span>

    <input type="range"
       class="form-range flex-grow-1 rating-slider"
       name="trust_{{ r.idx }}" id="id_trust_{{ r.idx }}"
       min="{{ min_rating }}" max="{{ max_rating }}" step="1" value="0"
       data-touchedoninput="document.getElementById('val_like_{{ r.idx }}').textContent=this.value;"
="0"
       oninput="
         this.dataset.touched='1';
         this.classList.add('touched');
         document.getElementById('val_trust_{{ r.idx }}').textContent=this.value;
       ">


    <span class="badge bg-secondary" id="val_trust_{{ r.idx }}">0</span>

    <span class="text-success">
      <i class="fas fa-smile"></i>
    </span>
  </div>
</div>


    </div>
  </div>
{% endfor %}

<div class="text-center mt-4">

  <div id="ratingWarning" class="alert alert-warning mx-3 mb-3 d-none">
  Please move every slider at least once (0 counts only if you intentionally choose it).
</div>

  {{ next_button }}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sliders = Array.from(document.querySelectorAll('.rating-slider'));
    const nextBtn = document.querySelector('button.otree-btn-next');
    const warning = document.getElementById('ratingWarning');

    sliders.forEach(slider => {
      const badgeId = slider.id.replace('id_', 'val_');
      const badge = document.getElementById(badgeId);
      if (badge) badge.textContent = slider.value;

      function markTouched() {
        slider.dataset.touched = '1';
        slider.classList.add('touched');
      }

      slider.addEventListener('mousedown', markTouched);
      slider.addEventListener('touchstart', markTouched);
      slider.addEventListener('keydown', markTouched);
      slider.addEventListener('change', markTouched);
    });

    function allTouched() {
      return sliders.every(s => s.dataset.touched === '1');
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', function (event) {
        if (!allTouched()) {
          event.preventDefault();
          warning.classList.remove('d-none');
          warning.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    }
  });
</script>

{% endblock %}
